{"body":"WebSvr\r\n==============\r\nLincense: MIT, GPL\r\n\r\nDescription:\r\n--------------\r\nA simple web server based on node.js\r\n\r\nVersion: 0.024\r\n--------------\r\n- Filter: A request will try to match all the filters first, and then pass to the Handler\r\n- Handler: When a request matched a handler, it will returned, only one handler will be executed\r\n- Session: Stored in file, with JSON format\r\n- File: Support uploading files\r\n\r\nStart\r\n--------------\r\nEdit in SiteTest.js or Create a new Site.js and added to MakeFile.list\r\n\r\n    //Start the WebSVr, runnting at parent folder, default port is 8054, directory browser enabled;\r\n    //Trying at: http://localhost:8054\r\n    var webSvr = new WebSvr({\r\n      root: \"../\",\r\n      listDir: true,\r\n      https: true,\r\n      httpsPort: 8443\r\n    });\r\n\r\n    webSvr.start();\r\n\r\nFilter\r\n--------------\r\nSession based authentication (session stored in files), all the request under \"test/\" will parse the post data and session by default, except the \"index.htm\" and \"login.do\"\r\n\r\n    /*\r\n    General filter: parse the post data / session before all request\r\n      parse:   parse the post data and stored in req.body;\r\n      session: init the session and stored in req.session; \r\n    */\r\n    webSvr.filter(function(req, res){\r\n      //TODO: Add greeting words in filter\r\n      //res.write(\"Hello WebSvr!<br/>\");\r\n\r\n      //Link to next filter\r\n      req.filter.next(req, res);\r\n    }, {parse:true, session:true});\r\n\r\n    /*\r\n    Session Filter: protect test/* folder => (validate by session);\r\n    */\r\n    webSvr.filter(/test\\/[\\w\\.]+/, function(req, res) {\r\n      //It's not index.htm/login.do, do the session validation\r\n      if (req.url.indexOf(\"index.htm\") < 0 && req.url.indexOf(\"login.do\") < 0) {\r\n        !req.session.get(\"username\") && res.end(\"You must login, first!\");\r\n      }\r\n\r\n      //Link to next filter\r\n      req.filter.next(req, res);\r\n    });\r\n\r\n\r\nHandler\r\n--------------\r\nHandle Login and put the username in Session\r\n\r\n    /*\r\n    Handler: login.do => (validate the username & password)\r\n      username: admin\r\n      password: 12345678\r\n    */\r\n    webSvr.session(/login.do/, function(req, res) {\r\n      var querystring = require(\"querystring\");\r\n\r\n      //TODO: Add an parameter to auto-complete querystring.parse(req.body);\r\n      var qs = querystring.parse(req.body);\r\n      if (qs.username == \"admin\" && qs.password == \"12345678\") {\r\n        //Put key/value pair in session\r\n        //TODO: Support put JSON object directly\r\n        req.session.set(\"username\", qs.username, function(session) {\r\n          //TODO: Add req.redirect / req.forward functionalities;\r\n          res.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n          res.writeFile(\"/test/setting.htm\");\r\n        });\r\n      }else{\r\n        res.writeHead(401);\r\n        res.end(\"Wrong username/password\");\r\n      }\r\n    });\r\n\r\nFile\r\n--------------\r\nReceive upload file (it's a specfic filter)\r\n\r\n    /*\r\n    Uploader: upload.do => (receive handler)\r\n    */\r\n    webSvr.file(/upload.do/, function(req, res) {\r\n      res.writeHead(200, {\"Content-Type\": \"text/plain\"});\r\n      //Upload file is stored in req.files\r\n      //form fields is stored in req.body\r\n      res.write(JSON.stringify(req.body));\r\n      res.end(JSON.stringify(req.files));\r\n    });\r\n\r\n\r\nOther APIs\r\n--------------\r\nRedirect\r\n\r\n    /*\r\n    Redirect: redirect request, try at: http://localhost:8054/redirect\r\n    */\r\n    webSvr.url(\"redirect\", function(req, res){\r\n      res.redirect(\"/svr/websvr.all.js\");\r\n    });\r\n\r\nUrl Mapping\r\n\r\n    //Mapping \"combine\" to tool/Combine.js, trying at: http://localhost:8054/combine\r\n    webSvr.url(/combine/, [\"svr/tool/Combine.js\"]);\r\n    //Mapping \"hello\" to a string, trying at http://localhost:8054/hello\r\n    webSvr.url(/hello/, \"Hello WebSvr!\");\r\n\r\nPost Data\r\n\r\n    //Mapping \"post\" and parse the post in the request, trying at: http://localhost:8054/post.htm\r\n    webSvr.post(/post.htm/, function(req, res) {\r\n      res.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n      //Need session support\r\n      res.write(\"You username is \" + req.session.get(\"username\"));\r\n      res.write('<form action=\"\" method=\"post\"><input name=\"input\" /></form><br/>');\r\n      res.end('Received : ' + req.body);\r\n    }, {session: true});","name":"Node-websvr","note":"Don't delete this file! It's used internally to help with page regeneration.","tagline":"","google":""}